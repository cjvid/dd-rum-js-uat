<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Datadog RUM Demo - Home</title>

  <!-- Datadog RUM -->
  <script src="https://www.datadoghq-browser-agent.com/us1/v6/datadog-rum.js" crossorigin="anonymous"></script>
  <script>
    // Initialize RUM
    window.DD_RUM && window.DD_RUM.init({
      clientToken: 'pub3a9242d3cff288df4f25082fefa8e4e7',
      applicationId: '93b458ba-4215-49d4-89cd-41f946ce2c1d',
      site: 'datadoghq.com',
      service: 'rum-test-site',
      env: 'uat',
      sessionSampleRate: 100,
      sessionReplaySampleRate: 100,
      trackUserInteractions: true,
      trackResources: true,
      trackLongTasks: true,
      defaultPrivacyLevel: 'mask-user-input',
      version: '1.0.0'
    });

    // Start session replay recording
    window.DD_RUM && window.DD_RUM.startSessionReplayRecording();

    // Restore user if already logged in
    const savedUser = JSON.parse(sessionStorage.getItem('currentUser'));
    if (savedUser) {
      window.DD_RUM.setUser(savedUser);
      console.log("RUM user restored:", savedUser);
    }
  </script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header class="header">
    <h1>Datadog RUM Demo</h1>
    <p>Interactive test site for RUM</p>
  </header>

  <!-- Login Section -->
  <section class="card">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Enter username" />
    <input type="email" id="email" placeholder="Enter email" />
    <select id="plan">
      <option value="free">Free</option>
      <option value="premium">Premium</option>
      <option value="enterprise">Enterprise</option>
    </select>
    <button onclick="loginUser()">Login</button>
    <p id="login-status"></p>
  </section>

  <!-- Existing interactive sections -->
  <section class="card">
    <h2>Primary Action</h2>
    <button class="btn-primary" onclick="handleClick()">Click Me</button>
    <p id="click-result"></p>
  </section>

  <script>
    function loginUser() {
      const username = document.getElementById('username').value;
      const email = document.getElementById('email').value;
      const plan = document.getElementById('plan').value;

      if (!username || !email) {
        alert("Please fill all fields");
        return;
      }

      // Generate user ID (simulate backend)
      const userId = 'user-' + Math.floor(Math.random() * 100000);

      const user = { id: userId, name: username, email, plan };

      // Save for session
      sessionStorage.setItem('currentUser', JSON.stringify(user));

      // Identify user in RUM
      window.DD_RUM.setUser(user);

      document.getElementById('login-status').innerText =
        `Logged in as ${username} â€” RUM tracking enabled.`;

      console.log("RUM user set:", user);
    }

    // Example interactive function
    function handleClick() {
      document.getElementById("click-result").innerText = "Button clicked!";
    }
  </script>

</body>
</html>
